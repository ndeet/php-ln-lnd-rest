# LndRest

A [Lightning Network Daemon (LND)](https://github.com/lightningnetwork/lnd) package for LND's REST endpoints. PHP classes are generated by the [Swagger Codegen](https://github.com/swagger-api/swagger-codegen) project using LND's [rpc.swagger.json](https://github.com/lightningnetwork/lnd/blob/master/lnrpc/rpc.swagger.json)

- Based on LND version: 0.7.1-beta
- This package version: 0.7.1

## Requirements

PHP 7.0 and later

## Installation & Usage
### Composer

To install the bindings via [Composer](http://getcomposer.org/), use the following command:

```
composer require ndeet/ln-lnd-rest
```

## Tests

To run the unit tests:

```
composer install
./vendor/bin/phpunit
```

## Getting Started

Note: 
- The examples in the generated classes docs are not working out of the box. You will need to pass the port, use SSL and also 
use macaroons of your properly secured LND installation.
- Generated classes with lnd-0.5-beta are not tested yet by me due to lack of time currently. Fingers crossed everything works.

```php
<?php
require_once(__DIR__ . '/vendor/autoload.php');

// Get tls and macaroon paths.
$tlsPath = '';
$macaroonPath = '';
$local_user = posix_getpwuid(posix_getuid());

switch (PHP_OS) {
  case "Darwin":
    $tlsPath = $local_user['dir'] . '/Library/Application Support/Lnd/tls.cert';
    $macaroonPath = $local_user['dir'] . '/Library/Application Support/Lnd/macaroon.admin';
    break;

  case "Linux":
    $tlsPath = $local_user['dir'] . '/.lnd/tls.cert';
    $macaroonPath = $local_user['dir'] . '/.lnd/macaroon.admin';
}

if (! $sslCert = file_get_contents($tlsPath)) {
  $certError = <<<EOT
    tls.cert not found in "example" directory. Make sure to copy it from your 
    LND config directory.
    MacOS: ~/Library/Application Support/Lnd/tls.cert
    Linux: ~/.lnd/tls.cert
EOT;

  throw new Exception($certError);
}

// We need to use Configuration class for the url and can't pass it directly in GuzzleClient.
$apiConfig = new \Lnd\Rest\Configuration();
$apiConfig->setHost('https://localhost:8001');

// First we need to unlock the encrypted wallet. This needs only run once.
$walletInstance = new Lnd\Rest\Api\WalletUnlockerApi(
// If you want use custom http client, pass your client which implements `GuzzleHttp\ClientInterface`.
// This is optional, `GuzzleHttp\Client` will be used as default.
  new GuzzleHttp\Client([
    'debug' => TRUE,
    'verify' => $tlsPath,
    'headers' => [
      'Grpc-Metadata-macaroon' => $macaroon
    ]
  ]),
  $apiConfig
);

$unlockRequest = new \Lnd\Rest\Model\LnrpcUnlockWalletRequest([
  'walletPassword' => base64_encode('YOUR_WALLET_PASS')
]);

try {
  $unlocked = $walletInstance->unlockWallet($unlockRequest);
  // gives 408 timeout but unlock successful, afterwards 404 not found
} catch (Exception $e) {
  echo 'Exception when calling WalletUnlockerApi->unlockWallet(): ', $e->getMessage(), PHP_EOL;
}

// We can now use the getInfo endpoint:
$apiInstance = new Lnd\Rest\Api\LightningApi(
// If you want use custom http client, pass your client which implements `GuzzleHttp\ClientInterface`.
// This is optional, `GuzzleHttp\Client` will be used as default.
  new GuzzleHttp\Client([
    'debug' => TRUE,
    'verify' => $tlsPath,
    'headers' => [
      'Grpc-Metadata-macaroon' => bin2hex(file_get_contents($macaroonPath))
    ]
  ]),
  $apiConfig
);

try {
  $result = $apiInstance->getInfo();
  var_dump($result);
} catch (Exception $e) {
  echo 'Exception when calling LightningApi->getInfo: ', $e->getMessage(), PHP_EOL;
}

// Let's generate an lightning invoice.
$invoice = new \Lnd\Rest\Model\LnrpcInvoice([
  'memo' => 'testinvoice memo',
  'value' => 1001,
  'expiry' => 3600
]);

try {
  $invoiceResult = $apiInstance->addInvoice($invoice);
  var_dump($invoiceResult);
} catch (Exception $e) {
  echo 'Exception when calling LightningApi->addInvoice: ', $e->getMessage(), PHP_EOL;
}

?>
```

## Notice regarding to subscribeInvoices endpoint
The REST endpoints are generated from the same gRPC `rpc.proto` file and it seems the streaming does not work on REST services according to LND's lead developer [@roasbeef](https://github.com/roasbeef). But they plan to provide Websockets in a future release. So you may need to do some custom long polling using [**lookupInvoice**](docs/Api/LightningApi.md#lookupinvoice) endpoint.

This are some autogenerated docs pointing to classes docs:
## Documentation for API Endpoints

All URIs are relative to *http://localhost*

Class | Method | HTTP request | Description
------------ | ------------- | ------------- | -------------
*LightningApi* | [**addInvoice**](docs/Api/LightningApi.md#addinvoice) | **POST** /v1/invoices | * lncli: &#x60;addinvoice&#x60; AddInvoice attempts to add a new invoice to the invoice database. Any duplicated invoices are rejected, therefore all invoices *must* have a unique payment preimage.
*LightningApi* | [**channelBalance**](docs/Api/LightningApi.md#channelbalance) | **GET** /v1/balance/channels | * lncli: &#x60;channelbalance&#x60; ChannelBalance returns the total funds available across all open channels in satoshis.
*LightningApi* | [**closeChannel**](docs/Api/LightningApi.md#closechannel) | **DELETE** /v1/channels/{channel_point.funding_txid_str}/{channel_point.output_index} | * lncli: &#x60;closechannel&#x60; CloseChannel attempts to close an active channel identified by its channel outpoint (ChannelPoint). The actions of this method can additionally be augmented to attempt a force close after a timeout period in the case of an inactive peer. If a non-force close (cooperative closure) is requested, then the user can specify either a target number of blocks until the closure transaction is confirmed, or a manual fee rate. If neither are specified, then a default lax, block confirmation target is used.
*LightningApi* | [**closedChannels**](docs/Api/LightningApi.md#closedchannels) | **GET** /v1/channels/closed | * lncli: &#x60;closedchannels&#x60; ClosedChannels returns a description of all the closed channels that  this node was a participant in.
*LightningApi* | [**connectPeer**](docs/Api/LightningApi.md#connectpeer) | **POST** /v1/peers | * lncli: &#x60;connect&#x60; ConnectPeer attempts to establish a connection to a remote peer. This is at the networking level, and is used for communication between nodes. This is distinct from establishing a channel with a peer.
*LightningApi* | [**decodePayReq**](docs/Api/LightningApi.md#decodepayreq) | **GET** /v1/payreq/{pay_req} | * lncli: &#x60;decodepayreq&#x60; DecodePayReq takes an encoded payment request string and attempts to decode it, returning a full description of the conditions encoded within the payment request.
*LightningApi* | [**deleteAllPayments**](docs/Api/LightningApi.md#deleteallpayments) | **DELETE** /v1/payments | * DeleteAllPayments deletes all outgoing payments from DB.
*LightningApi* | [**describeGraph**](docs/Api/LightningApi.md#describegraph) | **GET** /v1/graph | * lncli: &#x60;describegraph&#x60; DescribeGraph returns a description of the latest graph state from the point of view of the node. The graph information is partitioned into two components: all the nodes/vertexes, and all the edges that connect the vertexes themselves.  As this is a directed graph, the edges also contain the node directional specific routing policy which includes: the time lock delta, fee information, etc.
*LightningApi* | [**disconnectPeer**](docs/Api/LightningApi.md#disconnectpeer) | **DELETE** /v1/peers/{pub_key} | * lncli: &#x60;disconnect&#x60; DisconnectPeer attempts to disconnect one peer from another identified by a given pubKey. In the case that we currently have a pending or active channel with the target peer, then this action will be not be allowed.
*LightningApi* | [**feeReport**](docs/Api/LightningApi.md#feereport) | **GET** /v1/fees | * lncli: &#x60;feereport&#x60; FeeReport allows the caller to obtain a report detailing the current fee schedule enforced by the node globally for each channel.
*LightningApi* | [**forwardingHistory**](docs/Api/LightningApi.md#forwardinghistory) | **POST** /v1/switch | * lncli: &#x60;fwdinghistory&#x60; ForwardingHistory allows the caller to query the htlcswitch for a record of all HTLC&#39;s forwarded within the target time range, and integer offset within that time range. If no time-range is specified, then the first chunk of the past 24 hrs of forwarding history are returned.
*LightningApi* | [**getChanInfo**](docs/Api/LightningApi.md#getchaninfo) | **GET** /v1/graph/edge/{chan_id} | * lncli: &#x60;getchaninfo&#x60; GetChanInfo returns the latest authenticated network announcement for the given channel identified by its channel ID: an 8-byte integer which uniquely identifies the location of transaction&#39;s funding output within the blockchain.
*LightningApi* | [**getInfo**](docs/Api/LightningApi.md#getinfo) | **GET** /v1/getinfo | * lncli: &#x60;getinfo&#x60; GetInfo returns general information concerning the lightning node including it&#39;s identity pubkey, alias, the chains it is connected to, and information concerning the number of open+pending channels.
*LightningApi* | [**getNetworkInfo**](docs/Api/LightningApi.md#getnetworkinfo) | **GET** /v1/graph/info | * lncli: &#x60;getnetworkinfo&#x60; GetNetworkInfo returns some basic stats about the known channel graph from the point of view of the node.
*LightningApi* | [**getNodeInfo**](docs/Api/LightningApi.md#getnodeinfo) | **GET** /v1/graph/node/{pub_key} | * lncli: &#x60;getnodeinfo&#x60; GetNodeInfo returns the latest advertised, aggregated, and authenticated channel information for the specified node identified by its public key.
*LightningApi* | [**getTransactions**](docs/Api/LightningApi.md#gettransactions) | **GET** /v1/transactions | * lncli: &#x60;listchaintxns&#x60; GetTransactions returns a list describing all the known transactions relevant to the wallet.
*LightningApi* | [**listChannels**](docs/Api/LightningApi.md#listchannels) | **GET** /v1/channels | * lncli: &#x60;listchannels&#x60; ListChannels returns a description of all the open channels that this node is a participant in.
*LightningApi* | [**listInvoices**](docs/Api/LightningApi.md#listinvoices) | **GET** /v1/invoices | * lncli: &#x60;listinvoices&#x60; ListInvoices returns a list of all the invoices currently stored within the database. Any active debug invoices are ignored. It has full support for paginated responses, allowing users to query for specific invoices through their add_index. This can be done by using either the first_index_offset or last_index_offset fields included in the response as the index_offset of the next request. The reversed flag is set by default in order to paginate backwards. If you wish to paginate forwards, you must explicitly set the flag to false. If none of the parameters are specified, then the last 100 invoices will be returned.
*LightningApi* | [**listPayments**](docs/Api/LightningApi.md#listpayments) | **GET** /v1/payments | * lncli: &#x60;listpayments&#x60; ListPayments returns a list of all outgoing payments.
*LightningApi* | [**listPeers**](docs/Api/LightningApi.md#listpeers) | **GET** /v1/peers | * lncli: &#x60;listpeers&#x60; ListPeers returns a verbose listing of all currently active peers.
*LightningApi* | [**lookupInvoice**](docs/Api/LightningApi.md#lookupinvoice) | **GET** /v1/invoice/{r_hash_str} | * lncli: &#x60;lookupinvoice&#x60; LookupInvoice attempts to look up an invoice according to its payment hash. The passed payment hash *must* be exactly 32 bytes, if not, an error is returned.
*LightningApi* | [**newWitnessAddress**](docs/Api/LightningApi.md#newwitnessaddress) | **GET** /v1/newaddress | * NewWitnessAddress creates a new witness address under control of the local wallet.
*LightningApi* | [**openChannelSync**](docs/Api/LightningApi.md#openchannelsync) | **POST** /v1/channels | * OpenChannelSync is a synchronous version of the OpenChannel RPC call. This call is meant to be consumed by clients to the REST proxy. As with all other sync calls, all byte slices are intended to be populated as hex encoded strings.
*LightningApi* | [**pendingChannels**](docs/Api/LightningApi.md#pendingchannels) | **GET** /v1/channels/pending | * lncli: &#x60;pendingchannels&#x60; PendingChannels returns a list of all the channels that are currently considered \&quot;pending\&quot;. A channel is pending if it has finished the funding workflow and is waiting for confirmations for the funding txn, or is in the process of closure, either initiated cooperatively or non-cooperatively.
*LightningApi* | [**queryRoutes**](docs/Api/LightningApi.md#queryroutes) | **GET** /v1/graph/routes/{pub_key}/{amt} | * lncli: &#x60;queryroutes&#x60; QueryRoutes attempts to query the daemon&#39;s Channel Router for a possible route to a target destination capable of carrying a specific amount of satoshis. The retuned route contains the full details required to craft and send an HTLC, also including the necessary information that should be present within the Sphinx packet encapsulated within the HTLC.
*LightningApi* | [**sendCoins**](docs/Api/LightningApi.md#sendcoins) | **POST** /v1/transactions | * lncli: &#x60;sendcoins&#x60; SendCoins executes a request to send coins to a particular address. Unlike SendMany, this RPC call only allows creating a single output at a time. If neither target_conf, or sat_per_byte are set, then the internal wallet will consult its fee model to determine a fee for the default confirmation target.
*LightningApi* | [**sendPaymentSync**](docs/Api/LightningApi.md#sendpaymentsync) | **POST** /v1/channels/transactions | * SendPaymentSync is the synchronous non-streaming version of SendPayment. This RPC is intended to be consumed by clients of the REST proxy. Additionally, this RPC expects the destination&#39;s public key and the payment hash (if any) to be encoded as hex strings.
*LightningApi* | [**sendToRouteSync**](docs/Api/LightningApi.md#sendtoroutesync) | **POST** /v1/channels/transactions/route | * SendToRouteSync is a synchronous version of SendToRoute. It Will block until the payment either fails or succeeds.
*LightningApi* | [**subscribeInvoices**](docs/Api/LightningApi.md#subscribeinvoices) | **GET** /v1/invoices/subscribe | * SubscribeInvoices returns a uni-directional stream (sever -&gt; client) for notifying the client of newly added/settled invoices. The caller can optionally specify the add_index and/or the settle_index. If the add_index is specified, then we&#39;ll first start by sending add invoice events for all invoices with an add_index greater than the specified value.  If the settle_index is specified, the next, we&#39;ll send out all settle events for invoices with a settle_index greater than the specified value.  One or both of these fields can be set. If no fields are set, then we&#39;ll only send out the latest add/settle events.
*LightningApi* | [**updateChannelPolicy**](docs/Api/LightningApi.md#updatechannelpolicy) | **POST** /v1/chanpolicy | * lncli: &#x60;updatechanpolicy&#x60; UpdateChannelPolicy allows the caller to update the fee schedule and channel policies for all channels globally, or a particular channel.
*LightningApi* | [**walletBalance**](docs/Api/LightningApi.md#walletbalance) | **GET** /v1/balance/blockchain | * lncli: &#x60;walletbalance&#x60; WalletBalance returns total unspent outputs(confirmed and unconfirmed), all confirmed unspent outputs and all unconfirmed unspent outputs under control of the wallet.
*WalletUnlockerApi* | [**changePassword**](docs/Api/WalletUnlockerApi.md#changepassword) | **POST** /v1/changepassword | * lncli: &#x60;changepassword&#x60; ChangePassword changes the password of the encrypted wallet. This will automatically unlock the wallet database if successful.
*WalletUnlockerApi* | [**genSeed**](docs/Api/WalletUnlockerApi.md#genseed) | **GET** /v1/genseed | * GenSeed is the first method that should be used to instantiate a new lnd instance. This method allows a caller to generate a new aezeed cipher seed given an optional passphrase. If provided, the passphrase will be necessary to decrypt the cipherseed to expose the internal wallet seed.
*WalletUnlockerApi* | [**initWallet**](docs/Api/WalletUnlockerApi.md#initwallet) | **POST** /v1/initwallet | *  InitWallet is used when lnd is starting up for the first time to fully initialize the daemon and its internal wallet. At the very least a wallet password must be provided. This will be used to encrypt sensitive material on disk.
*WalletUnlockerApi* | [**unlockWallet**](docs/Api/WalletUnlockerApi.md#unlockwallet) | **POST** /v1/unlockwallet | * lncli: &#x60;unlock&#x60; UnlockWallet is used at startup of lnd to provide a password to unlock the wallet database.


## Documentation For Models

 - [ChannelCloseSummaryClosureType](docs/Model/ChannelCloseSummaryClosureType.md)
 - [LnrpcAddInvoiceResponse](docs/Model/LnrpcAddInvoiceResponse.md)
 - [LnrpcChangePasswordRequest](docs/Model/LnrpcChangePasswordRequest.md)
 - [LnrpcChangePasswordResponse](docs/Model/LnrpcChangePasswordResponse.md)
 - [LnrpcChannel](docs/Model/LnrpcChannel.md)
 - [LnrpcChannelBalanceResponse](docs/Model/LnrpcChannelBalanceResponse.md)
 - [LnrpcChannelCloseSummary](docs/Model/LnrpcChannelCloseSummary.md)
 - [LnrpcChannelCloseUpdate](docs/Model/LnrpcChannelCloseUpdate.md)
 - [LnrpcChannelEdge](docs/Model/LnrpcChannelEdge.md)
 - [LnrpcChannelEdgeUpdate](docs/Model/LnrpcChannelEdgeUpdate.md)
 - [LnrpcChannelFeeReport](docs/Model/LnrpcChannelFeeReport.md)
 - [LnrpcChannelGraph](docs/Model/LnrpcChannelGraph.md)
 - [LnrpcChannelOpenUpdate](docs/Model/LnrpcChannelOpenUpdate.md)
 - [LnrpcChannelPoint](docs/Model/LnrpcChannelPoint.md)
 - [LnrpcCloseStatusUpdate](docs/Model/LnrpcCloseStatusUpdate.md)
 - [LnrpcClosedChannelUpdate](docs/Model/LnrpcClosedChannelUpdate.md)
 - [LnrpcClosedChannelsResponse](docs/Model/LnrpcClosedChannelsResponse.md)
 - [LnrpcConfirmationUpdate](docs/Model/LnrpcConfirmationUpdate.md)
 - [LnrpcConnectPeerRequest](docs/Model/LnrpcConnectPeerRequest.md)
 - [LnrpcConnectPeerResponse](docs/Model/LnrpcConnectPeerResponse.md)
 - [LnrpcDebugLevelResponse](docs/Model/LnrpcDebugLevelResponse.md)
 - [LnrpcDeleteAllPaymentsResponse](docs/Model/LnrpcDeleteAllPaymentsResponse.md)
 - [LnrpcDisconnectPeerResponse](docs/Model/LnrpcDisconnectPeerResponse.md)
 - [LnrpcFeeLimit](docs/Model/LnrpcFeeLimit.md)
 - [LnrpcFeeReportResponse](docs/Model/LnrpcFeeReportResponse.md)
 - [LnrpcForwardingEvent](docs/Model/LnrpcForwardingEvent.md)
 - [LnrpcForwardingHistoryRequest](docs/Model/LnrpcForwardingHistoryRequest.md)
 - [LnrpcForwardingHistoryResponse](docs/Model/LnrpcForwardingHistoryResponse.md)
 - [LnrpcGenSeedResponse](docs/Model/LnrpcGenSeedResponse.md)
 - [LnrpcGetInfoResponse](docs/Model/LnrpcGetInfoResponse.md)
 - [LnrpcGraphTopologyUpdate](docs/Model/LnrpcGraphTopologyUpdate.md)
 - [LnrpcHTLC](docs/Model/LnrpcHTLC.md)
 - [LnrpcHop](docs/Model/LnrpcHop.md)
 - [LnrpcHopHint](docs/Model/LnrpcHopHint.md)
 - [LnrpcInitWalletRequest](docs/Model/LnrpcInitWalletRequest.md)
 - [LnrpcInitWalletResponse](docs/Model/LnrpcInitWalletResponse.md)
 - [LnrpcInvoice](docs/Model/LnrpcInvoice.md)
 - [LnrpcLightningAddress](docs/Model/LnrpcLightningAddress.md)
 - [LnrpcLightningNode](docs/Model/LnrpcLightningNode.md)
 - [LnrpcListChannelsResponse](docs/Model/LnrpcListChannelsResponse.md)
 - [LnrpcListInvoiceResponse](docs/Model/LnrpcListInvoiceResponse.md)
 - [LnrpcListPaymentsResponse](docs/Model/LnrpcListPaymentsResponse.md)
 - [LnrpcListPeersResponse](docs/Model/LnrpcListPeersResponse.md)
 - [LnrpcNetworkInfo](docs/Model/LnrpcNetworkInfo.md)
 - [LnrpcNewAddressResponse](docs/Model/LnrpcNewAddressResponse.md)
 - [LnrpcNodeAddress](docs/Model/LnrpcNodeAddress.md)
 - [LnrpcNodeInfo](docs/Model/LnrpcNodeInfo.md)
 - [LnrpcNodeUpdate](docs/Model/LnrpcNodeUpdate.md)
 - [LnrpcOpenChannelRequest](docs/Model/LnrpcOpenChannelRequest.md)
 - [LnrpcOpenStatusUpdate](docs/Model/LnrpcOpenStatusUpdate.md)
 - [LnrpcPayReq](docs/Model/LnrpcPayReq.md)
 - [LnrpcPayment](docs/Model/LnrpcPayment.md)
 - [LnrpcPeer](docs/Model/LnrpcPeer.md)
 - [LnrpcPendingChannelsResponse](docs/Model/LnrpcPendingChannelsResponse.md)
 - [LnrpcPendingHTLC](docs/Model/LnrpcPendingHTLC.md)
 - [LnrpcPendingUpdate](docs/Model/LnrpcPendingUpdate.md)
 - [LnrpcPolicyUpdateRequest](docs/Model/LnrpcPolicyUpdateRequest.md)
 - [LnrpcPolicyUpdateResponse](docs/Model/LnrpcPolicyUpdateResponse.md)
 - [LnrpcQueryRoutesResponse](docs/Model/LnrpcQueryRoutesResponse.md)
 - [LnrpcRoute](docs/Model/LnrpcRoute.md)
 - [LnrpcRouteHint](docs/Model/LnrpcRouteHint.md)
 - [LnrpcRoutingPolicy](docs/Model/LnrpcRoutingPolicy.md)
 - [LnrpcSendCoinsRequest](docs/Model/LnrpcSendCoinsRequest.md)
 - [LnrpcSendCoinsResponse](docs/Model/LnrpcSendCoinsResponse.md)
 - [LnrpcSendManyResponse](docs/Model/LnrpcSendManyResponse.md)
 - [LnrpcSendRequest](docs/Model/LnrpcSendRequest.md)
 - [LnrpcSendResponse](docs/Model/LnrpcSendResponse.md)
 - [LnrpcSendToRouteRequest](docs/Model/LnrpcSendToRouteRequest.md)
 - [LnrpcSignMessageResponse](docs/Model/LnrpcSignMessageResponse.md)
 - [LnrpcStopResponse](docs/Model/LnrpcStopResponse.md)
 - [LnrpcTransaction](docs/Model/LnrpcTransaction.md)
 - [LnrpcTransactionDetails](docs/Model/LnrpcTransactionDetails.md)
 - [LnrpcUnlockWalletRequest](docs/Model/LnrpcUnlockWalletRequest.md)
 - [LnrpcUnlockWalletResponse](docs/Model/LnrpcUnlockWalletResponse.md)
 - [LnrpcVerifyMessageResponse](docs/Model/LnrpcVerifyMessageResponse.md)
 - [LnrpcWalletBalanceResponse](docs/Model/LnrpcWalletBalanceResponse.md)
 - [PendingChannelsResponseClosedChannel](docs/Model/PendingChannelsResponseClosedChannel.md)
 - [PendingChannelsResponseForceClosedChannel](docs/Model/PendingChannelsResponseForceClosedChannel.md)
 - [PendingChannelsResponsePendingChannel](docs/Model/PendingChannelsResponsePendingChannel.md)
 - [PendingChannelsResponsePendingOpenChannel](docs/Model/PendingChannelsResponsePendingOpenChannel.md)
 - [PendingChannelsResponseWaitingCloseChannel](docs/Model/PendingChannelsResponseWaitingCloseChannel.md)


## Documentation For Authorization

 All endpoints do not require authorization.


## Author




